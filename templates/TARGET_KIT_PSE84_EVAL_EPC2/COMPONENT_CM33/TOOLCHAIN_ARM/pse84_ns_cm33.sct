#! armclang -E --target=arm-arm-none-eabi -mcpu=cortex-m33 -xc
; command above MUST be in first line (no comment above!)
/***************************************************************************//**
* \file pse84_ns_cm33.sct
* \version 1.0.0
*
* scatter file for the armclang C compiler.
*
* The main purpose of this file is to describe how the sections in the
* input files should be mapped into the output file, and to control the memory
* layout of the output file.
*
* \note The entry point location starts at 0x14000000. The valid
* application image should be placed there.
*
* \note The linker files included with the PDL template projects must be generic
* and handle all common use cases. Your project may not use every section
* defined in the linker files. In that case you may see warnings during the
* build process. In your project, you can simply comment out or remove the
* relevant code in the linker file.
*
********************************************************************************
* \copyright
* Copyright (c) (2020-2025), Cypress Semiconductor Corporation (an Infineon company) or
* an affiliate of Cypress Semiconductor Corporation.
* SPDX-License-Identifier: Apache-2.0
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*******************************************************************************/

/* Include the device memory definitions generated by the Device Configurator */
#include "../../config/GeneratedSource/cymem_armlink_CM33_0.sct"

/* Define the stack size for the application */
/* To set stack size in application add makefile ldflags: --predefine="-DAPP_MSP_STACK_SIZE=0x2000" */
#ifdef APP_MSP_STACK_SIZE
#define __STACK_SIZE    APP_MSP_STACK_SIZE
#else
#define __STACK_SIZE    0x0001000
#endif

/* User Stack & Heap boundary definition */
/* Place the top of the stack at the end of the m33_data */
#define __STACK_TOP    (CYMEM_CM33_0_m33_data_START + CYMEM_CM33_0_m33_data_SIZE)
/* Position the beginning of the heap right after the noinit ER, ensuring an 8-byte alignment */
#define __HEAP_BASE    AlignExpr(ImageLimit(noinit), 8)
/* The heap extends to the stack */
#define __HEAP_SIZE    (__STACK_TOP - __STACK_SIZE - __HEAP_BASE)

/* Device definitions */
#define VECTORS_ALIGNMENT 1024

/* The size of the MCU boot header area at the start of FLASH */
#define MCUBOOT_HEADER_SIZE  0x400

/* The start address and size of shared memory sub-block in shared memory region for the current core
 * The approach is to have an equal sub-block for each core to avoid shared objects to be overlapped.
 * Default configuration: A sub-block for CM33_NS shared data will be 2nd.
 */
#define CORE_SYSTEM_SHARED_MEM_SIZE    (CYMEM_CM33_0_m33_m55_system_shared_SIZE / 3)
#define CORE_SYSTEM_SHARED_MEM_START   (CYMEM_CM33_0_m33_m55_system_shared_START + CORE_SYSTEM_SHARED_MEM_SIZE)

/* Serial Memory Interface block #0 memory #1, 16 MB */
LR_XIP_PORT0 (CYMEM_CM33_0_m33_nvm_C_START + MCUBOOT_HEADER_SIZE) (CYMEM_CM33_0_m33_nvm_SIZE - MCUBOOT_HEADER_SIZE)
{
  /* The execution region is designated for the main non-secure (NS) application code for the Cortex-M33 */
  app_code_main (CYMEM_CM33_0_m33_nvm_C_START + MCUBOOT_HEADER_SIZE) ALIGN VECTORS_ALIGNMENT (CYMEM_CM33_0_m33_nvm_SIZE - MCUBOOT_HEADER_SIZE)
  {
    *.* (RESET, +First)
    *(InRoot$$Sections)
    .ANY (+RO)
    .ANY (+XO)
    EXCLUDE(*cy_smif.*, *cy_syslib.*, *cy_syslib_ext.*, *cy_smif_memslot.*, *cy_smif_sfdp.*, *cy_smif_hb_flash.*, *cyhal_qspi.*, *mtb_hal_memoryspi.*, *mtb_serial_memory.*, *freertos/Source*.*, *clib-support*.*, *abstraction-rtos*.*, */cmsis*.*)
  }

  /* The execution region for performance-sensitive or critical functions that need to be executed in SRAM */
  app_code_ram CYMEM_CM33_0_m33_code_START CYMEM_CM33_0_m33_code_SIZE
  {
    *(.cy_sram1_code)
    *(.cy_ramfunc)
    *(.text.cy_os_common)
    cy_syslib.* (+RO)
    cy_syslib_ext.* (+RO)
    cy_smif.* (+RO)
    cy_smif_hb_flash.* (+RO)
    cy_smif_memslot.* (+RO)
    cy_smif_sfdp.* (+RO)
    cyhal_qspi.* (+RO)
    mtb_hal_memoryspi.* (+RO)
    mtb_serial_memory.* (+RO)
    *freertos/Source*.* (+RO)
    *clib-support*.* (+RO)
    *abstraction-rtos*.* (+RO)
    */cmsis*.* (+RO)
    *mtb_ml_nnlite* (+RO)
      
    *cy_ipc_pipe* (+RO)

    *audio_app* (+RO)
    *audio_send_task* (+RO)
    *tune_app_svc_lp* (+RO)
    *tune_battery_powered_audio* (+RO)
    *audio_receive_task* (+RO)
    *button_press* (+RO)
    *audio_conv_utils* (+RO)
    
    *audio_timeline_marker* (+RO)
    
    *cy_retarget_io* (+RO)
    
    *usb_audio_interface* (+RO)
    *audio_usb_send_utils* (+RO)
    *usbd_os_abs_rtos* (+RO)
    *usbd_config_io* (+RO)
    *usbd_config* (+RO)
    
    *nnkernel* (+RO +RW, +ZI)
    *sp_enh* (+RO +RW, +ZI)
    
    *libusbd_base_d_cm33f_armc6* (+RO +RW, +ZI)
    *libusbd_base_r_cm33f_armc6* (+RO +RW, +ZI)
  }


  /* A region for the vector table */
  ram_vectors AlignExpr(CYMEM_CM33_0_m33_data_START, VECTORS_ALIGNMENT) ALIGN VECTORS_ALIGNMENT UNINIT CYMEM_CM33_0_m33_data_SIZE
  {
    *(.bss.noinit.RESET_RAM)
  }

  /* The execution region for initialized data memory */
  app_data_main AlignExpr(ImageLimit(ram_vectors), 8) ALIGN 8 CYMEM_CM33_0_m33_data_SIZE
  {
    .ANY (+RW +ZI)
  }

  /* A region for shared RAM memory */
  cy_sharedmem CORE_SYSTEM_SHARED_MEM_START ALIGN 32 CORE_SYSTEM_SHARED_MEM_SIZE
  {
    *(.cy_sharedmem)
  }

  /* A region for shared SOC memory */
  cy_shared_socmem CYMEM_CM33_0_m33_m55_shared_START CYMEM_CM33_0_m33_m55_shared_SIZE
  {
    *(.cy_shared_socmem)
  }

}

/* SRAM, 1 MB */
/* Note. This load region must not contain any loadable data; only UNINIT or BSS execution regions are allowed */
LR_SRAM CYMEM_CM33_0_m33_data_START CYMEM_CM33_0_m33_data_SIZE
{
  /* A section for non-initialized data memory */
  bss AlignExpr(ImageLimit(app_data_main), 16) ALIGN 16 (CYMEM_CM33_0_m33_data_SIZE - AlignExpr(ImageLength(ram_vectors), VECTORS_ALIGNMENT) - AlignExpr(ImageLength(app_data_main), 4))
  {
    *(.bss)
    *(.bss.*)
  }

  /* A region for variables that should not be initialized during the device startup */
  noinit AlignExpr(ImageLimit(bss), 4) ALIGN 4 UNINIT (CYMEM_CM33_0_m33_data_SIZE - AlignExpr(ImageLength(ram_vectors), VECTORS_ALIGNMENT) - AlignExpr(ImageLength(app_data_main), 4) - AlignExpr(ImageLength(bss), 4))
  {
    *(.noinit)
    *(.bss.noinit)
  }

  /* A region for the heap memory */
  ARM_LIB_HEAP __HEAP_BASE EMPTY __HEAP_SIZE
  {
  }

  /* A region for stack */
  ARM_LIB_STACK __STACK_TOP EMPTY -__STACK_SIZE
  {
  }
}


/* System SRAM (SoCMEM), 5MB */
/* Note. This load region must not contain any loadable data; only UNINIT or BSS execution regions are allowed */
LR_SOCMEM CYMEM_CM33_0_gfx_mem_START CYMEM_CM33_0_gfx_mem_SIZE
{
  /* A region for the GPU buffer */
  cy_gfx_mem CYMEM_CM33_0_gfx_mem_START CYMEM_CM33_0_gfx_mem_SIZE
  {
    *(.cy_gpu_buf)
  }
}
